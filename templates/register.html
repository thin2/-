<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
    />
    <title>错题管理系统 - 注册</title>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" />
    <link rel="stylesheet" href="/static/css/base.css" />
    <link rel="stylesheet" href="/static/css/auth.css" />
  </head>
  <body>
    <!-- 页面装饰元素 -->
    <div class="decor decor1"></div>
    <div class="decor decor2"></div>
    <div class="decor decor3"></div>

    <div id="app" class="auth-wrapper">
      <div class="auth-layout">
        <!-- 左侧背景区 -->
        <div class="auth-left">
          <div class="left-content">
            <h2 class="left-title">错题管理系统</h2>
            <p class="left-desc">智能管理错题，精准提升成绩，让每一次复习都更有价值</p>
          </div>
        </div>

        <!-- 右侧注册区 -->
        <div class="auth-right">
          <div class="right-decor"></div>

          <div class="register-header">
            <h3 class="register-title">注册账号</h3>
          </div>

          <el-form :model="form" :rules="rules" ref="registerFormRef" label-width="0">
            <el-form-item prop="username">
              <label class="form-label">账号</label>
              <el-input
                v-model="form.username"
                placeholder="请输入账号"
              ></el-input>
            </el-form-item>

            <el-form-item prop="password">
              <label class="form-label">设置密码</label>
              <el-input
                v-model="form.password"
                type="password"
                placeholder="密码长度 6-10 位，区分大小写"
              ></el-input>
            </el-form-item>

            <el-form-item prop="confirm">
              <label class="form-label">确认密码</label>
              <el-input
                v-model="form.confirm"
                type="password"
                placeholder="再次输入密码"
              ></el-input>
            </el-form-item>

            <el-button
              type="primary"
              class="register-button"
              :disabled="loading"
              :loading="loading"
              @click="submitForm"
              style="background: #4299e1; border-color: #4299e1;"
            >
              立即注册
            </el-button>

            <div class="back-login">
              <el-button type="text" @click="goLogin">
                已有账号？返回登录
              </el-button>
            </div>
          </el-form>
        </div>
      </div>
    </div>

    <script src="/static/js/axios.min.js"></script>
    <script src="/static/js/vue.js"></script>
    <script src="/static/js/element-ui.js"></script>
    <script src="/static/js/request.js"></script>
    <script src="/static/js/apis/auth.js"></script>
    <script >
      new Vue({
        el: "#app",
        data() {
          return {
            form: {
              username: "",
              password: "",
              confirm: "",
            },
            loading: false,
          };
        },
        computed: {
          rules() {
            const vm = this;
            return {
              username: [
                { required: true, message: '请输入账号', trigger: 'blur' }
              ],
              password: [
                { required: true, message: '请输入密码', trigger: 'blur' },
                { min: 6, max: 10, message: '密码长度在 6 到 10 个字符', trigger: 'blur' }
              ],
              confirm: [
                { required: true, message: '请再次输入密码', trigger: 'blur' },
                { 
                  validator: (rule, value, callback) => {
                    if (!value) {
                      callback(new Error('请再次输入密码'));
                    } else if (value !== vm.form.password) {
                      callback(new Error('两次输入的密码不一致'));
                    } else {
                      callback();
                    }
                  }, 
                  trigger: 'blur' 
                }
              ]
            };
          }
        },
        methods: {
          async submitForm() {
            this.$refs.registerFormRef.validate(async (valid) => {
              if (!valid) {
                return false;
              }
              this.loading = true;
              try {
                const result = await authAPI.register({
                  username: this.form.username,
                  password: this.form.password
                });
                this.$message.success(result.message || "注册成功，跳转至登录");
                setTimeout(() => {
                  window.location.href = "/login";
                }, 800);
              } catch (error) {
                const message = error.message || "注册失败，请稍后再试";
                this.$message.error(message);
              } finally {
                this.loading = false;
              }
            });
          },
          goLogin() {
            window.location.href = "/login";
          },
        },
      });
    </script>
  </body>
</html>
