# 2. 需求分析

## 2.1 功能性需求

### 2.1.1 用户认证与授权

#### 用户注册
- **需求描述**：新用户可以通过用户名和密码注册账号
- **输入**：用户名（唯一）、密码（6-10位）
- **输出**：注册成功提示，自动生成昵称
- **业务规则**：
  - 用户名不能重复
  - 密码长度6-10位
  - 注册成功后自动登录

#### 用户登录
- **需求描述**：已注册用户通过用户名和密码登录系统
- **输入**：用户名、密码
- **输出**：JWT Token、用户基本信息
- **业务规则**：
  - 验证用户名和密码
  - Token有效期24小时
  - 登录失败提示错误信息

#### 用户退出
- **需求描述**：用户主动退出登录
- **输入**：无
- **输出**：退出成功提示
- **业务规则**：清除本地Token，跳转登录页

### 2.1.2 科目管理

#### 科目列表
- **需求描述**：显示用户创建的所有科目
- **输入**：无
- **输出**：科目列表（包含名称、颜色、图标、错题数量）
- **业务规则**：
  - 按排序字段和ID排序
  - 显示每个科目的错题数量
  - 只显示未删除的科目

#### 创建科目
- **需求描述**：用户创建新的学习科目
- **输入**：科目名称（必填）、颜色（可选）、图标（可选）
- **输出**：创建成功的科目信息
- **业务规则**：
  - 科目名称不能为空
  - 颜色默认蓝色（#4299e1）
  - 图标默认书本图标（fas fa-book）

#### 更新科目
- **需求描述**：修改已有科目的信息
- **输入**：科目ID、要修改的字段（名称、颜色、图标、排序）
- **输出**：更新后的科目信息
- **业务规则**：只能修改自己的科目

#### 删除科目
- **需求描述**：删除指定科目（软删除）
- **输入**：科目ID
- **输出**：删除成功提示
- **业务规则**：
  - 软删除，不真正删除数据
  - 删除后该科目的错题仍保留

### 2.1.3 错题管理

#### 错题列表
- **需求描述**：分页显示用户的错题列表
- **输入**：页码、每页数量、筛选条件（关键词、科目、难度、题型、日期范围）
- **输出**：错题列表、总数、分页信息
- **业务规则**：
  - 支持多条件组合筛选
  - 默认按创建时间倒序
  - 每页最多100条

#### 错题详情
- **需求描述**：查看单个错题的完整信息
- **输入**：错题ID
- **输出**：错题完整信息（题目、答案、选项、标签、图片等）
- **业务规则**：只能查看自己的错题

#### 创建错题
- **需求描述**：添加新的错题记录
- **输入**：
  - 必填：标题、科目ID、题型、难度、题目内容、正确答案、错误原因
  - 可选：选项列表、标签列表、图片URL列表
- **输出**：创建成功的错题信息
- **业务规则**：
  - 所有必填字段不能为空
  - 难度：1-简单、2-中等、3-困难
  - 题型：single_choice、multiple_choice、judgement、essay等

#### 更新错题
- **需求描述**：修改已有错题的信息
- **输入**：错题ID、要修改的字段
- **输出**：更新后的错题信息
- **业务规则**：只能修改自己的错题

#### 删除错题
- **需求描述**：删除指定错题（软删除）
- **输入**：错题ID
- **输出**：删除成功提示
- **业务规则**：软删除，数据仍保留在数据库

#### 图片上传
- **需求描述**：上传错题相关图片
- **输入**：图片文件
- **输出**：图片URL
- **业务规则**：
  - 支持png、jpg、jpeg、gif、webp格式
  - 单文件最大5MB
  - 按日期组织存储路径

### 2.1.4 复习中心

#### 复习统计
- **需求描述**：显示复习相关的统计数据
- **输入**：无
- **输出**：今日复习数、待复习数、已复习数、连续天数
- **业务规则**：
  - 今日复习：当天有复习记录的错题数
  - 连续天数：从今天往前连续有复习记录的天数

#### 复习任务列表
- **需求描述**：根据复习模式获取待复习的题目列表
- **输入**：
  - 复习模式：pending（待复习）、random（随机）、important（重点）、difficulty（按难度）
  - 筛选条件：科目ID、难度
  - 分页参数
- **输出**：题目列表
- **业务规则**：
  - pending模式：显示所有待复习题目
  - random模式：随机抽取待复习题目
  - important模式：显示标记为重点的题目
  - difficulty模式：按难度从低到高排序

#### 提交复习结果
- **需求描述**：记录单题的复习结果
- **输入**：错题ID、复习结果（forgot/hard/mastered）、备注（可选）
- **输出**：更新后的复习状态
- **业务规则**：
  - forgot（忘记了）：标记为待复习，下次复习时间+1天
  - hard（有点难）：标记为待复习，标记为重点，下次复习时间+1天
  - mastered（已掌握）：标记为已复习，取消重点标记，清除下次复习时间
  - 复习次数自动+1

### 2.1.5 出卷自测

#### 生成试卷
- **需求描述**：从错题库中抽取题目生成试卷
- **输入**：
  - 科目ID列表（必填）
  - 题目数量（5-50）
  - 难度模式（all/simple/medium/hard）
  - 出题方式（random/unreviewed/important）
  - 时间限制（分钟，0为不限时）
- **输出**：试卷ID、题目列表、时间限制
- **业务规则**：
  - 至少选择一个科目
  - 题目数量在5-50之间
  - 随机抽取符合条件的题目

#### 提交答卷
- **需求描述**：提交试卷答案并自动评分
- **输入**：题目ID列表、答案字典、用时（秒）
- **输出**：得分、正确率、详细结果
- **业务规则**：
  - 答案比较不区分大小写和空格
  - 计算正确数、错误数、未作答数
  - 返回每题的对错情况

#### 保存错题
- **需求描述**：将考试中的错题保存到错题本
- **输入**：错题ID、错误原因（可选）
- **输出**：保存成功提示
- **业务规则**：如果提供了错误原因，更新错题的错误原因

### 2.1.6 AI学习助手

#### AI对话
- **需求描述**：与AI助手进行对话，获取学习帮助
- **输入**：消息内容、模型（可选）、温度（可选）
- **输出**：AI回复（流式输出）
- **业务规则**：
  - 使用SSE（Server-Sent Events）实现流式输出
  - 自动保存对话历史
  - 系统提示词限制为学习相关话题
  - 默认使用GLM-4.5-flash模型

#### 聊天历史
- **需求描述**：查看与AI的对话历史记录
- **输入**：限制数量（默认10）
- **输出**：历史消息列表
- **业务规则**：
  - 按时间正序排列
  - 包含用户消息和AI回复
  - 最多返回50条记录

#### 删除历史
- **需求描述**：清空所有聊天历史记录
- **输入**：无
- **输出**：删除数量
- **业务规则**：只删除当前用户的记录

### 2.1.7 数据统计

#### 仪表盘统计
- **需求描述**：显示学习数据的概览统计
- **输入**：无
- **输出**：
  - 总错题数
  - 科目数量
  - 已复习数
  - 待复习数
  - 复习完成率
  - 本周复习数
- **业务规则**：实时计算统计数据

#### 错题分类分布
- **需求描述**：按科目统计错题分布
- **输入**：无
- **输出**：科目名称、错题数量、颜色
- **业务规则**：用于饼图展示

#### 复习趋势
- **需求描述**：显示最近7天的复习趋势
- **输入**：无
- **输出**：日期列表、每日复习数量
- **业务规则**：用于折线图展示

#### 掌握状态分布
- **需求描述**：统计各掌握状态的错题数量
- **输入**：无
- **输出**：已掌握、有点难、忘记了、未复习的数量
- **业务规则**：用于柱状图展示

### 2.1.8 个人中心

#### 个人资料
- **需求描述**：查看和修改个人资料
- **输入**：昵称、邮箱、手机、性别、头像、简介
- **输出**：更新后的用户信息
- **业务规则**：
  - 头像支持图片上传
  - 邮箱和手机格式验证（可选）

#### 修改密码
- **需求描述**：修改登录密码
- **输入**：旧密码、新密码
- **输出**：修改成功提示
- **业务规则**：
  - 验证旧密码
  - 新密码长度6-10位

## 2.2 非功能性需求

### 2.2.1 性能需求

#### 响应时间
- **API接口响应时间**：平均 < 200ms，95%的请求 < 500ms
- **AI对话首字延迟**：< 3秒
- **页面加载时间**：首屏 < 2秒
- **数据库查询**：单表查询 < 100ms

#### 吞吐量
- **并发用户数**：支持至少50个并发用户
- **API请求处理**：每秒至少处理100个请求
- **文件上传**：支持同时上传多个文件

#### 资源使用
- **内存占用**：服务器内存占用 < 512MB（无AI请求时）
- **存储空间**：单用户数据 < 100MB（包含图片）
- **数据库大小**：支持至少10000条错题记录

### 2.2.2 安全性需求

#### 身份认证
- **密码加密**：使用Werkzeug的bcrypt算法加密存储
- **Token机制**：使用JWT（JSON Web Token）进行身份验证
- **Token过期**：Token有效期24小时，过期需重新登录
- **密码强度**：密码长度6-10位，建议包含字母和数字

#### 数据安全
- **SQL注入防护**：使用SQLAlchemy ORM防止SQL注入
- **XSS防护**：前端输入验证和转义
- **CSRF防护**：使用Token机制防止跨站请求伪造
- **文件上传安全**：文件类型验证、大小限制、文件名安全处理

#### 访问控制
- **权限验证**：所有API接口（除登录注册）都需要Token验证
- **数据隔离**：用户只能访问自己的数据
- **资源保护**：防止未授权访问其他用户的错题和科目

### 2.2.3 兼容性需求

#### 浏览器兼容
- **Chrome**：支持最新版本及前2个版本
- **Firefox**：支持最新版本及前2个版本
- **Safari**：支持最新版本及前2个版本
- **Edge**：支持最新版本及前2个版本
- **移动端浏览器**：支持iOS Safari和Android Chrome

#### 设备兼容
- **桌面端**：支持1920x1080及以上分辨率
- **平板端**：支持768x1024及以上分辨率
- **移动端**：支持375x667及以上分辨率（响应式设计）

#### 技术兼容
- **Python版本**：Python 3.8+
- **Node.js**：不需要Node.js（纯前端静态资源）
- **数据库**：SQLite 3.x（可迁移到MySQL/PostgreSQL）

### 2.2.4 可用性需求

#### 系统可用性
- **正常运行时间**：> 99%（月度）
- **故障恢复时间**：< 1小时
- **数据备份**：每日自动备份数据库

#### 用户体验
- **界面友好**：使用Element UI提供统一的UI组件
- **操作简便**：关键操作不超过3步
- **错误提示**：友好的错误提示信息
- **加载提示**：长时间操作显示加载动画

### 2.2.5 可维护性需求

#### 代码质量
- **代码规范**：遵循PEP 8（Python）和ESLint（JavaScript）
- **代码注释**：关键函数和类添加文档字符串
- **模块化设计**：前后端分离，模块职责清晰

#### 文档完整性
- **API文档**：完整的接口文档（API文档.md）
- **数据库文档**：数据库表结构说明
- **部署文档**：部署和配置说明

### 2.2.6 可扩展性需求

#### 功能扩展
- **插件机制**：预留扩展接口
- **模块化设计**：便于添加新功能模块
- **配置化**：关键参数可配置

#### 性能扩展
- **数据库迁移**：支持从SQLite迁移到MySQL/PostgreSQL
- **缓存机制**：可添加Redis缓存提升性能
- **负载均衡**：支持多实例部署

## 2.3 用户故事

### 用户故事1：作为学生，我希望能够注册和登录系统
**优先级**：高  
**验收标准**：
- 能够使用用户名和密码注册新账号
- 能够使用注册的账号登录系统
- 登录后能够访问系统功能
- 登录状态能够保持24小时

### 用户故事2：作为学生，我希望能够管理学习科目
**优先级**：高  
**验收标准**：
- 能够创建、修改、删除科目
- 能够为科目设置颜色和图标
- 能够查看每个科目的错题数量

### 用户故事3：作为学生，我希望能够添加和管理错题
**优先级**：高  
**验收标准**：
- 能够添加新错题，包含题目、答案、错误原因
- 能够为错题添加图片
- 能够为错题添加标签
- 能够搜索和筛选错题
- 能够修改和删除错题

### 用户故事4：作为学生，我希望系统能够帮我安排复习
**优先级**：高  
**验收标准**：
- 能够查看待复习的错题列表
- 能够按不同模式获取复习任务（随机、按科目、重点题）
- 能够记录复习结果（忘记、有点难、已掌握）
- 能够查看复习统计数据

### 用户故事5：作为学生，我希望能够生成试卷进行自测
**优先级**：中  
**验收标准**：
- 能够选择科目和题目数量生成试卷
- 能够在线答题
- 能够自动评分并查看结果
- 能够将错题保存到错题本

### 用户故事6：作为学生，我希望能够使用AI助手解答问题
**优先级**：中  
**验收标准**：
- 能够与AI进行对话获取学习帮助
- AI回复能够实时流式显示
- 能够查看历史对话记录
- AI能够理解学习相关的问题

### 用户故事7：作为学生，我希望能够查看学习数据统计
**优先级**：中  
**验收标准**：
- 能够在仪表盘查看学习概览
- 能够查看错题分类分布图表
- 能够查看复习趋势图表
- 能够查看掌握状态分布

### 用户故事8：作为学生，我希望能够管理个人资料
**优先级**：低  
**验收标准**：
- 能够修改昵称、头像、简介等信息
- 能够修改登录密码
- 修改后能够立即生效

---

**文档版本**：v1.0  
**创建日期**：2025-12-02  
**最后更新**：2025-12-02

